rAnkle = [x y z];

t1 = cos(xi);
t2 = cos(eta);
t3 = sin(eta);
t4 = sin(zeta);
t5 = sin(xi);
t6 = cos(zeta);
t7 = t1 * t4;
t8 = t5 * t6;
t9 = t1 * t6;
t10 = t5 * t4;
RMAnkle = [t1 * t2 t7 * t3 + t8 -t9 * t3 + t10; -t5 * t2 -t10 * t3 + t9 t8 * t3 + t7; t3 -t2 * t4 t2 * t6;];

t1 = cos(xi);
t2 = cos(eta);
t3 = sin(xi);
t4 = sin(eta);
t5 = -K1ax * t1 + K1ay * t3;
t6 = sin(zeta);
t7 = cos(zeta);
t1 = -K1ax * t3 - K1ay * t1;
t3 = K1az * t2;
t8 = t5 * t4;
rK1com = [-K1az * t4 + t2 * t5 + x t1 * t7 + t6 * (t3 + t8) + y t1 * t6 + t7 * (-t3 - t8) + z];

t1 = cos(xi);
t2 = cos(eta);
t3 = sin(eta);
t4 = sin(zeta);
t5 = sin(xi);
t6 = cos(zeta);
t7 = t1 * t4;
t8 = t5 * t6;
t9 = t1 * t6;
t10 = t5 * t4;
RMK1com = [t1 * t2 t3 * t7 + t8 -t3 * t9 + t10; -t5 * t2 -t10 * t3 + t9 t3 * t8 + t7; t3 -t2 * t4 t2 * t6;];

t1 = cos(xi);
t2 = cos(eta);
t3 = sin(xi);
t4 = sin(eta);
t5 = -K1ax + K1cx;
t6 = -K1az + K1cz;
t7 = K1ay - K1cy;
t8 = t7 * t3;
t9 = t5 * t1;
t10 = t8 + t9;
t11 = sin(zeta);
t12 = cos(zeta);
t1 = -t1 * t7 + t3 * t5;
t3 = t6 * t2;
rK1c = [t10 * t2 + t4 * t6 + x t1 * t12 + t11 * (t10 * t4 - t3) + y t1 * t11 + t12 * (t4 * (-t8 - t9) + t3) + z];

t1 = cos(eta);
t2 = sin(K1crz);
t3 = sin(xi);
t4 = cos(K1crz);
t5 = cos(xi);
t6 = t2 * t3 - t4 * t5;
t7 = sin(eta);
t8 = sin(zeta);
t9 = cos(zeta);
t2 = t2 * t5 + t3 * t4;
t3 = t8 * t6;
t4 = t2 * t9;
t5 = t9 * t6;
t10 = t8 * t2;
RMK1c = [-t1 * t6 -t3 * t7 + t4 t5 * t7 + t10; -t1 * t2 -t10 * t7 - t5 t4 * t7 - t3; t7 -t1 * t8 t1 * t9;];

t1 = cos(th);
t2 = sin(K1crz);
t3 = cos(xi);
t4 = cos(eta);
t5 = cos(K1crz);
t6 = sin(xi);
t7 = sin(th);
t8 = sin(eta);
t9 = t2 * t3 + t5 * t6;
t10 = K2ax * t2 + K1ay - K1cy;
t11 = -K2ax * t5 - K1ax + K1cx;
t12 = t10 * t6;
t13 = t11 * t3;
t14 = t9 * t1 * K2ay;
t9 = t9 * t7 * K2az;
t15 = t12 + t13 + t14 - t9;
t16 = -K2ay * t7 - K2az * t1 - K1az + K1cz;
t17 = cos(zeta);
t18 = sin(zeta);
t2 = t2 * t6 - t3 * t5;
t1 = t2 * t1 * K2ay - t2 * t7 * K2az - t10 * t3 + t11 * t6;
t2 = t16 * t4;
rK2com = [t15 * t4 + t16 * t8 + x t1 * t17 + t18 * (t15 * t8 - t2) + y t1 * t18 + t17 * (t8 * (-t12 - t13 - t14 + t9) + t2) + z];

t1 = cos(eta);
t2 = sin(K1crz);
t3 = sin(xi);
t4 = cos(K1crz);
t5 = cos(xi);
t6 = t2 * t3 - t4 * t5;
t7 = sin(eta);
t8 = sin(zeta);
t9 = cos(zeta);
t2 = t2 * t5 + t3 * t4;
t3 = t6 * t8;
t4 = t6 * t9;
t5 = cos(th);
t10 = sin(th);
t11 = t1 * t5;
t12 = t7 * t10;
t13 = t7 * t5;
t14 = t1 * t10;
t15 = -t13 * t2 - t14;
t16 = t12 * t2 - t11;
RMK2com = [-t1 * t6 t2 * t9 - t3 * t7 t2 * t8 + t4 * t7; -t11 * t2 + t12 t15 * t8 - t4 * t5 -t15 * t9 - t3 * t5; t14 * t2 + t13 t4 * t10 + t16 * t8 t3 * t10 - t16 * t9;];

t1 = cos(xi);
t2 = cos(eta);
t3 = sin(xi);
t4 = sin(eta);
t5 = K1ay - K1by;
t6 = -K1ax + K1bx;
t7 = t5 * t3;
t8 = t6 * t1;
t9 = t8 + t7;
t10 = -K1az + K1bz;
t11 = sin(zeta);
t12 = cos(zeta);
t1 = -t1 * t5 + t3 * t6;
t3 = t10 * t2;
rHeel = [t10 * t4 + t2 * t9 + x t1 * t12 + t11 * (t4 * t9 - t3) + y t1 * t11 + t12 * (t4 * (-t8 - t7) + t3) + z];

t1 = cos(xi);
t2 = cos(eta);
t3 = cos(K1bry);
t4 = sin(xi);
t5 = sin(K1bry);
t6 = sin(K1brx);
t7 = sin(eta);
t8 = cos(K1brx);
t9 = t2 * t6;
t10 = t7 * t8;
t11 = -t9 * t4 - t10;
t12 = t1 * t3;
t13 = sin(zeta);
t14 = cos(zeta);
t15 = t1 * t7 * t13 + t14 * t4;
t16 = t7 * t6;
t17 = t2 * t8;
t18 = t1 * t6;
t19 = t18 * t14;
t20 = (-t16 * t4 + t17) * t13;
t21 = t4 * t5;
t22 = t3 * t4;
t9 = -t10 * t4 - t9;
t8 = t8 * t1;
t1 = t1 * t5;
RMHeel = [t11 * t5 + t12 * t2 t15 * t3 + t5 * (t20 + t19) t13 * (t18 * t5 + t22) + t14 * (t7 * (t21 * t6 - t12) - t17 * t5); -t17 * t4 + t16 t13 * t9 + t8 * t14 t8 * t13 - t14 * t9; t1 * t2 - t11 * t3 t15 * t5 + t3 * (-t20 - t19) t13 * (-t12 * t6 + t21) + t14 * (t7 * (-t22 * t6 - t1) + t17 * t3);];

t1 = cos(th);
t2 = sin(K1crz);
t3 = cos(xi);
t4 = cos(eta);
t5 = cos(K1crz);
t6 = sin(xi);
t7 = sin(th);
t8 = sin(eta);
t9 = t2 * t3 + t5 * t6;
t10 = -K2ax * t5 - K1ax + K1cx;
t11 = K2ax * t2 + K1ay - K1cy;
t12 = t9 * t1 * K2ay;
t9 = t9 * t7 * K2az;
t13 = t10 * t3;
t14 = t11 * t6;
t15 = t12 - t9 + t13 + t14;
t16 = -K2ay * t7 - K2az * t1 - K1az + K1cz;
t17 = cos(zeta);
t18 = sin(zeta);
t2 = t2 * t6 - t3 * t5;
t1 = t2 * t1 * K2ay - t2 * t7 * K2az + t10 * t6 - t11 * t3;
t2 = t16 * t4;
rForeFoot = [t15 * t4 + t16 * t8 + x t1 * t17 + t18 * (t15 * t8 - t2) + y t1 * t18 + t17 * (t8 * (-t12 + t9 - t13 - t14) + t2) + z];

t1 = cos(eta);
t2 = sin(K1crz);
t3 = sin(xi);
t4 = cos(K1crz);
t5 = cos(xi);
t6 = t2 * t3 - t4 * t5;
t7 = sin(eta);
t8 = sin(zeta);
t9 = cos(zeta);
t2 = t2 * t5 + t3 * t4;
t3 = t6 * t8;
t4 = t6 * t9;
t5 = cos(th);
t10 = sin(th);
t11 = t1 * t5;
t12 = t7 * t10;
t13 = t7 * t5;
t14 = t1 * t10;
t15 = -t13 * t2 - t14;
t16 = t12 * t2 - t11;
RMForeFoot = [-t1 * t6 t2 * t9 - t3 * t7 t2 * t8 + t4 * t7; -t11 * t2 + t12 t15 * t8 - t4 * t5 -t15 * t9 - t3 * t5; t14 * t2 + t13 t4 * t10 + t16 * t8 t3 * t10 - t16 * t9;];

